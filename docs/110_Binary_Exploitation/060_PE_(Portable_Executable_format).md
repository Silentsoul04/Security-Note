# PE (Portable Executable format)
[TOC]
###### tags: `Security` `PWN` `ReverseEngineering` 

# Reference
* NTU-Computer-Security-2019-Fall

# Softwares
 + ### PEview
 讀 32-bit PE / COFF file 的結構和內容
 + ### PE-bear
 + ### CFF Explorer
 
# knowledge
### [Special Sections](https://docs.microsoft.com/en-us/windows/win32/debug/pe-format?redirectedfrom=MSDN#special-sections)
 * .text: Code 
 * .data: Initialized data
 * .bss: Uninitialized data
 * .rdata: Const/read-only (and initialized) data
 * .edata: Export descriptors
 * .idata: Import descriptors
 * .reloc: Relocation table (for code instructions with absolute addressing when the module could not be loaded at its preferred base address)
 * .rsrc: Resources (icon, bitmap, dialog, ...)
 * .tls: __declspec(thread) data (Fails with dynamically loaded DLLs -> hard to find bugs)
 
### COFF file
![](https://i.imgur.com/YcgolOr.png)
![](https://i.imgur.com/nWr6R3S.png)


`IMAGE_FILE_HEADER` 後會接著一連串的 `IMAGE_SECTION_HEADER`
![](https://i.imgur.com/mBzfZMN.png)
#### IMAGE_FILE_HEADER
`IMAGE_FILE_HEADER` 會標明 section 的數量
![](https://i.imgur.com/UOdhZOO.png)
#### IMAGE_SECTION_HEADER
![](https://i.imgur.com/UMGCwdM.png)

### PE file
![](https://i.imgur.com/uT5zGW7.png)

#### Optional Header
![](https://i.imgur.com/EWzBffT.png)
![](https://i.imgur.com/kYhS0P7.png)
![](https://i.imgur.com/ZWJecrd.png)
![](https://i.imgur.com/lCHusBC.png)

### Win32 Process
![](https://i.imgur.com/6FgPoMC.png)

![](https://i.imgur.com/QZHBhoH.png)

#### PEB/TEB(TIB)
最大的用處在於儲存關於 process 本身的資訊，讓 process 可以不呼叫 `Win32 API`
![](https://i.imgur.com/uFHdBbf.png)
![](https://i.imgur.com/2NWXYJG.png)
![](https://i.imgur.com/he1TfcE.png)

![](https://i.imgur.com/vBpgEmu.png)

### Structured Exception Handling
1. SEH is a feature to support `try{} catch (...) {}`
2. Vectored exception handling is an extension to structured exception handling
3. 需要在 visual studio 啟用設定
![](https://i.imgur.com/Ypnem1j.png)

![](https://i.imgur.com/TOQXKgw.png)
